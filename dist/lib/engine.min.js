const keys=[],mouse={pressed:!1,x:0,y:0},listeners={keydown:[],keyup:[],mousedown:[],mouseup:[],mousemove:[]};class Input{static isKeyDown(t){return keys.includes(t)}static isMouseDown(){return mouse.pressed}static getMousePosition(){return{x:mouse.x,y:mouse.y}}static listen(t,e){listeners[t].push(e)}}document.onkeydown=(t=>{listeners.keydown.forEach(e=>e(t.key));const e=t.key;keys.includes(e)||keys.push(e)}),document.onkeyup=(t=>{listeners.keyup.forEach(e=>e(t.key));var e=keys.indexOf(t.key);-1!==e&&keys.splice(e,1)}),document.onmousedown=(t=>{listeners.mousedown.forEach(e=>e(t.button)),mouse.pressed=!0}),document.onmouseup=(t=>{listeners.mouseup.forEach(e=>e(t.button)),mouse.pressed=!1}),document.onmousemove=(t=>{listeners.mousemove.forEach(e=>e(t.button)),mouse.x=t.offsetX,mouse.y=t.offsetY});class Renderer{constructor(t,e){this.canvas=document.querySelector("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=t,this.canvas.height=e,this.current_color="black",this.CLEAR_COLOR_BLACK="black",this.CLEAR_COLOR_WHITE="white",this.CLEAR_COLOR_RED="red",this.CLEAR_COLOR_BLUE="blue",this.CLEAR_COLOR_GREEN="green",this.CLEAR_COLOR_YELLOW="yellow"}clear(t){this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)}color(t,e,s){this.current_color="rgb("+t+", "+e+", "+s+")"}rect(t,e,s,i,r){r?(this.context.fillStyle=this.current_color,this.context.fillRect(t,e,s,i)):(this.context.strokeStyle=this.current_color,this.context.strokeRect(t,e,s,i))}arc(t,e,s,i,r,h){this.context.fillStyle=this.current_color,this.context.beginPath(),this.context.arc(t,e,s,i,r),h?this.context.fill():this.context.stroke()}text(t,e,s,i){this.context.fillStyle=this.current_color,this.context.font=e+"px Sans Serif",this.context.fillText(t,s,i)}image(t,e,s){s?this.context.drawImage(t,s.x,s.y,s.w,s.h,e.x,e.y,e.w,e.h):this.context.drawImage(t,e.x,e.y,e.w,e.h)}}class Sprite{constructor(t,e,s,i,r,h,n,o,a,c){this.renderer=t,this.src=e,this.uv={x:n,y:o,w:a,h:c},this.pos={x:s,y:i,w:r,h:h},this.img=new Image(this.pos.w,this.pos.h),this.img.src=this.src}draw(){this.uv.x?this.renderer.image(this.img,this.pos,this.uv):this.renderer.image(this.img,this.pos)}}class Text{constructor(t,e,s,i,r,h,n,o,a){switch(this.renderer=t,this.msg=e,this.size=s,this.x=i,this.y=r,this.color={r:n,g:o,b:a},this.width=this.renderer.context.measureText(this.msg).width,h){case"CENTER":this.x=this.x-this.width/2;break;case"NORMAL":this.x=this.x}}draw(){this.renderer.color(this.color.r,this.color.g,this.color.b),this.renderer.text(this.msg,this.size,this.x,this.y)}}class UIButton{constructor(t,e,s,i,r,h,n,o,a,c){this.renderer=t,this.rect={x:e,y:s,width:i,height:r},this.color={r:h,g:n,b:o},this.text=a,this.callback=c,this.rect.width=this.renderer.context.measureText(this.text).width,this.rect.x=this.rect.x-this.rect.width/2,Input.listen("mousedown",t=>{this.click(t)})}draw(){this.renderer.color(this.color.r,this.color.g,this.color.b),this.renderer.rect(this.rect.x,this.rect.y,2*this.rect.width,this.rect.height,!0),this.renderer.color(255-this.color.r,255-this.color.g,255-this.color.b),this.renderer.text(this.text,12,this.rect.x+this.rect.width/2,this.rect.y+this.rect.height/2)}click(t){let e={x:this.rect.x,y:this.rect.y,w:2*this.rect.width,h:this.rect.height};this.isInside(Input.getMousePosition(),e)&&this.callback()}isInside(t,e){return t.x>e.x&&t.x<e.x+e.w&&t.y<e.y+e.h&&t.y>e.y}}class Rectangle{constructor(t,e,s,i,r,h,n,o,a){this.renderer=t,this.rect={x:e,y:s,w:i,h:r},this.color={r:h,g:n,b:o},this.fill=a}draw(){this.renderer.color(this.color.r,this.color.g,this.color.b),this.renderer.rect(this.rect.x,this.rect.y,this.rect.w,this.rect.h,this.fill)}}class Arc{constructor(t,e,s,i,r,h,n,o,a,c){this.renderer=t,this.arc={x:e,y:s,rad:i,start:r,end:h},this.color={r:n,g:o,b:a},this.fill=c}draw(){this.renderer.color(this.color.r,this.color.g,this.color.b),this.renderer.arc(this.arc.x,this.arc.y,this.arc.rad,this.arc.start,this.arc.end,this.fill)}}class Animation{constructor(t,e,s,i){this.name=t,this.frames=e,this.frameRate=s,this.loop=i,this.currentFrame=0,this.currentFrameTime=0,this.playing=!1}play(){this.playing=!0}stop(){this.playing=!1}update(t){this.playing&&(this.currentFrameTime+=t,this.currentFrameTime>=this.frameRate&&(this.currentFrameTime=0,this.currentFrame++,this.currentFrame>=this.frames.length&&(this.loop?this.currentFrame=0:(this.currentFrame=this.frames.length-1,this.playing=!1))))}frame(){return this.frames[this.currentFrame]}frameIdx(){return this.currentFrame}frameTime(){return this.currentFrameTime}frameRate(){return this.frameRate}loop(){return this.loop}}class Entity{constructor(t,e){this.id=t,this.name=e,this.components={},this.tags=[]}AddComponent(t){this.components[t.name]=t}RemoveComponent(t){delete this.components[t.name]}HasComponent(t){return void 0!==this.components[t.name]}AddTag(t){this.tags.push(t)}RemoveTag(t){this.tags.splice(this.tags.indexOf(t),1)}HasTag(t){return-1!==this.tags.indexOf(t)}GetComponent(t){return this.components[t]}GetComponents(){const t=[];for(const e in this.components)this.components[e]instanceof Component&&t.push(this.components[e]);return t}GetTags(){return this.tags}GetId(){return this.id}GetName(){return this.name}SetName(t){this.name=t}OnAttach(){this.GetComponents().forEach(t=>{t.OnAttach()})}OnUpdate(){this.GetComponents().forEach(t=>{t.OnUpdate()})}}class Component{constructor(t,e){this.entity=t,this.name=e}OnAttach(){}OnUpdate(){}GetEntity(){return this.entity}}class Transform extends Component{constructor(t,e,s,i){super(t,"Transform"),this.position=e,this.rotation=s,this.scale=i}getPosition(){return this.position}getRotation(){return this.rotation}getScale(){return this.scale}setPosition(t){this.position=t}setRotation(t){this.rotation=t}setScale(t){this.scale=t}translate(t){this.position.x+=t.x,this.position.y+=t.y}rotate(t){this.rotation+=t}scale(t){this.scale+=t}}class SpriteRenderer extends Component{constructor(t,e,s,i){super(t,"SpriteRenderer"),this.renderer=e,this.image=s,this.pos=i}OnAttach(){this.sprite=new Sprite(this.renderer,this.image,this.pos.x,this.pos.y,this.pos.w,this.pos.h)}OnUpdate(){this.sprite.draw()}SetImage(t){this.sprite=t}}class ShapeRenderer extends Component{constructor(t,e,s,i,r,h){super(t,"ShapeRenderer"),this.sname=s,this.renderer=e,this.pos=i,this.color=r,this.fill=h}OnAttach(){switch(this.sname){case"rect":this.shape=new Rectangle(this.renderer,this.pos.x,this.pos.y,this.pos.w,this.pos.h,this.color.r,this.color.g,this.color.b,this.fill);break;case"arc":this.shape=new Arc(this.renderer,this.pos.x,this.pos.y,this.pos.r,this.pos.s,this.pos.e,this.color.r,this.color.g,this.color.b,this.fill)}}OnUpdate(){this.shape.draw()}}class TextRenderer extends Component{constructor(t,e,s,i,r,h,n){super(t,"TextRenderer"),this.renderer=e,this.text=s,this.size=i,this.color=r,this.pos=h,this.center=n}OnAttach(){const t=this.entity.GetComponent("Transform").getPosition();this.uiText=new Text(this.renderer,this.text,this.size,t.x,t.y,this.center?"CENTER":"NORMAL",this.color.r,this.color.g,this.color.b)}OnUpdate(){this.uiText.draw()}SetText(t){this.uiText.msg=t}GetText(){return this.uiText.msg}SetCenter(t){this.uiText.center=t}}class Animator extends Component{constructor(t,e){super(t,"Animator"),this.data=e}OnAttach(){this.animation=new Animation(this.data.name,this.data.frames,this.data.frameRate,this.data.loop)}OnUpdate(){this.GetEntity().GetComponent("SpriteRenderer")||console.log("No SpriteRenderer component found!"),this.animation.update(1),this.GetEntity().GetComponent("SpriteRenderer").SetImage(this.animation.frame())}LoadAnimation(t){this.data=t,this.OnAttach()}Play(){this.animation.play()}Stop(){this.animation.stop()}Frame(){return this.animation.frame()}FrameIdx(){return this.animation.frameIdx()}FrameTime(){return this.animation.frameTime()}FrameRate(){return this.animation.frameRate()}Loop(){return this.animation.loop()}Animation(){return this.animation}}class Button extends Component{constructor(t,e,s,i,r){super(t,"Button"),this.renderer=e,this.text=s,this.color=i,this.callback=r}OnAttach(){const t=this.entity.GetComponent("Transform").getPosition();this.button=new UIButton(this.renderer,t.x,t.y,t.w,t.h,this.color.r,this.color.g,this.color.b,this.text,this.callback)}OnUpdate(){this.button.draw()}SetText(t){this.text=t}SetColor(t){this.color=t}SetPosition(t){this.pos=t}SetCallback(t){this.callback=t}}class Script extends Component{constructor(t,e){super(t),this.script=e}OnAttach(){this.script.OnAttach(this.entity)}OnUpdate(){this.script.OnUpdate(this.entity)}}class Layer{constructor(t){this.name=t,this.enabled=!0,this.entities=[]}OnAttach(){this.GetEntities().forEach(t=>{t.OnAttach()})}OnUpdate(){this.GetEntities().forEach(t=>{t.OnUpdate()})}Enable(){this.enabled=!0}Disable(){this.enabled=!1}AddEntity(t){this.entities.push(t)}RemoveEntity(t){this.entities.splice(this.entities.indexOf(t),1)}HasEntity(t){return-1!==this.entities.indexOf(t)}GetEntities(){return this.entities}}class Game{constructor(t,e,s){this.title=t,document.title=t,this.layerstack=[],this.width=e,this.height=s,this.renderer=new Renderer(e,s)}init(){for(let t=0;t<this.layerstack.length;t++)this.layerstack[t]instanceof Layer&&this.layerstack[t].OnAttach()}tick(){this.renderer.clear(this.renderer.CLEAR_COLOR_BLACK),this.layerstack[0]&&(Input.isKeyDown("1")?this.layerstack[0].Disable():this.layerstack[0].Enable()),this.layerstack[1]&&(Input.isKeyDown("2")?this.layerstack[1].Disable():this.layerstack[1].Enable()),this.layerstack[2]&&(Input.isKeyDown("3")?this.layerstack[2].Disable():this.layerstack[2].Enable()),this.layerstack[3]&&(Input.isKeyDown("4")?this.layerstack[3].Disable():this.layerstack[3].Enable()),this.layerstack[4]&&(Input.isKeyDown("5")?this.layerstack[4].Disable():this.layerstack[4].Enable()),this.layerstack[5]&&(Input.isKeyDown("6")?this.layerstack[5].Disable():this.layerstack[5].Enable()),this.layerstack[6]&&(Input.isKeyDown("7")?this.layerstack[6].Disable():this.layerstack[6].Enable()),this.layerstack[7]&&(Input.isKeyDown("8")?this.layerstack[7].Disable():this.layerstack[7].Enable()),this.layerstack[8]&&(Input.isKeyDown("9")?this.layerstack[8].Disable():this.layerstack[8].Enable()),this.layerstack[9]&&(Input.isKeyDown("0")?this.layerstack[9].Disable():this.layerstack[9].Enable());for(let t=0;t<this.layerstack.length;t++)this.layerstack[t]instanceof Layer&&this.layerstack[t].enabled&&this.layerstack[t].OnUpdate()}push_layer(t){this.layerstack.includes(t)||this.layerstack.push(t)}get_layer(t){return this.layerstack[t]}pop_layer(t){let e=this.layerstack.indexOf(t);-1!==e&&this.layerstack.splice(e,1)}}